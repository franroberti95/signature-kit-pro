# How Vercel Works with Vite + Serverless Functions

## Single Repo - Everything Together ✅

You **DON'T need 2 repos**. Vercel handles both in one deployment:

```
your-project/
├── src/              # Vite frontend source
├── api/              # Vercel serverless functions
├── dist/             # Vite build output (static files)
└── vercel.json       # Vercel configuration
```

## How It Works

### 1. **Frontend (Vite)**
- **Source**: `src/` folder (React components, etc.)
- **Build**: `npm run build` → creates `dist/` folder
- **Output**: Static HTML, CSS, JS files in `dist/`
- **Served as**: Static files by Vercel

### 2. **Backend (Serverless Functions)**
- **Source**: `api/` folder (TypeScript files)
- **Build**: Vercel automatically compiles TypeScript
- **Output**: Each `.ts` file becomes a serverless function
- **Served as**: Serverless functions at `/api/*`

### 3. **Vercel Deployment**

When you deploy to Vercel:

```
1. Vercel runs: npm run build
   └── Creates dist/ folder (static frontend)

2. Vercel detects: api/ folder
   └── Compiles each .ts file as a serverless function

3. Vercel serves:
   ├── / → Static files from dist/
   ├── /api/test → Serverless function from api/test.ts
   ├── /api/auth/login → Serverless function from api/auth/login.ts
   └── etc.
```

## File Structure Example

```
signature-kit-pro/
├── src/
│   ├── pages/
│   │   └── Dashboard.tsx    # Frontend React component
│   └── App.tsx
│
├── api/
│   ├── auth/
│   │   └── login.ts          # → /api/auth/login
│   └── test.ts               # → /api/test
│
├── dist/                      # Generated by Vite build
│   ├── index.html
│   └── assets/
│
└── vercel.json                # Tells Vercel how to build
```

## How Frontend Calls Backend

In your React components:

```typescript
// src/pages/Dashboard.tsx
const response = await fetch('/api/auth/login', {
  method: 'POST',
  body: JSON.stringify({ email, password })
});
```

**What happens:**
1. Browser makes request to: `https://yourapp.vercel.app/api/auth/login`
2. Vercel routes it to: `api/auth/login.ts` serverless function
3. Function executes and returns response
4. Browser receives response

## Local Development (`vercel dev`)

When you run `vercel dev`:

```
1. Starts Vercel dev server on port 3000
2. Runs `npm run dev` (starts Vite on port 8080)
3. Proxies frontend requests to Vite
4. Serves API routes from api/ folder directly
```

**Access:**
- Frontend: `http://localhost:3000` (proxied to Vite)
- API: `http://localhost:3000/api/*` (serverless functions)

## Why It's Not Working

The issue is that `vercel dev` is:
- ✅ Starting Vite (port 8080)
- ✅ Starting Vercel dev server (port 3000)
- ❌ NOT executing the serverless functions (they hang)

This suggests:
1. TypeScript compilation issue
2. Module import issue
3. Vercel dev configuration issue

## Solution Options

### Option 1: Fix Vercel Dev (Recommended)
- Debug why functions aren't executing
- Check TypeScript compilation
- Verify module imports

### Option 2: Use Separate Dev Setup
- Run Vite directly: `npm run dev` (port 8080)
- Use Vite proxy to forward `/api/*` to a separate Node server
- More complex but gives you full control

### Option 3: Deploy to Vercel
- Sometimes `vercel dev` has issues but production works fine
- Deploy and test in production
- Use Vercel preview deployments

## Production Deployment

When you deploy to Vercel:

1. **Push to GitHub**
2. **Vercel auto-detects:**
   - `package.json` → knows it's a Node project
   - `vercel.json` → reads build config
   - `api/` folder → creates serverless functions
   - `dist/` folder → serves static files

3. **Everything just works** - no extra config needed!

## Key Points

✅ **Single repo** - Frontend + Backend together
✅ **Vite builds frontend** → `dist/` folder
✅ **Vercel compiles API routes** → Serverless functions
✅ **One deployment** - Everything deployed together
✅ **Same domain** - Frontend and API on same URL

The only issue is `vercel dev` local development, not the architecture!

